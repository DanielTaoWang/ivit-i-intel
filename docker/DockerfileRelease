# ivit-i-intel
FROM openvino/ubuntu18_dev_no_samples
USER root

ARG VER
ARG GITHUB_USER
ARG GITHUB_TOKEN

ENV IVIT=ivit-i-intel
ENV WS=/workspace
ENV GITHUB_REPOSITORY=InnoIPA/ivit-i-intel
ENV DEBIAN_FRONTEND=noninteractive  

# Download Repository
RUN apt-get update -q \
&& apt-get install -qqy git ssh openssh-server jq boxes \
&& git config --system credential.helper store \
&& echo "https://${GITHUB_USER}:${GITHUB_TOKEN}@github.com" > ~/.git-credentials \
&& git clone --recurse-submodules https://github.com/InnoIPA/ivit-i-intel.git --branch ${VER} \
&& mv -f ${IVIT} ${WS}

# Install Relatived Package
WORKDIR /workspace/docker/
RUN chmod u+x ./*.sh \
&& ./requirements.sh \
&& ./gen_inno_verify.sh \
&& mv ./inno_verify ./entrypoint /usr/bin

WORKDIR /workspace
RUN echo -e "\n - Cythonize iVIT-I ... \n" \
&& chmod u+x ./*.sh \
&& ./cythonize.sh \
&& echo -e "\n - Remove Relatived Script  ... \n" \
&& rm -rf ./docker \
&& rm ./cythonize.sh \
&& rm -rf ./.git*

# Define Entrypoint
ENTRYPOINT [ "entrypoint" ]

# docker run -it --privileged -v /dev:/dev --name ivit-i-intel  --device /dev/dri --device-cgroup-rule='c 189:* rmw'  --net=host --ipc=host -v /etc/localtime:/etc/localtime:ro -v /tmp/.x11-unix:/tmp/.x11-unix:rw -e DISPLAY=unix:0 maxchanginnodisk/ivit-i-intel:v0.8 /workspace/init_samples.sh bash